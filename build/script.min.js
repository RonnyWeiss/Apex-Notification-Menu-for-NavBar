var notificationMenu=function(){"use strict";var e={version:"1.0.5",isAPEX:function(){return"undefined"!=typeof apex},debug:{info:function(o){e.isAPEX()&&apex.debug.info(o)},error:function(o){e.isAPEX()?apex.debug.error(o):console.error(o)}},escapeHTML:function(o){if(null===o)return null;if(void 0!==o){if("object"==typeof o)try{o=JSON.stringify(o)}catch(e){}return e.isAPEX()?apex.util.escapeHTML(String(o)):(o=String(o)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}},jsonSaveExtend:function(e,o){var r={};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){console.error("Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(o)}else r=o;try{r=$.extend(!0,e,o)}catch(o){console.error("Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(o),r=e,console.error(r)}return r},link:function(e){return window.location=e},cutString:function(e,o){try{return o<0?e:e.length>o?e.substring(0,o-3)+"...":e}catch(o){return e}},removeHTML:function(o){return e.isAPEX()&&apex.util&&apex.util.stripHTML?apex.util.stripHTML(o):$("<div/>").html(o).text()}};return{initialize:function(o,r,t,a,n){function i(o){if(r)apex.server.plugin(r,{pageItems:a},{success:o,error:function(r){e.debug.error(r.responseText),o({row:[{NOTE_ICON:"fa-exclamation-triangle",NOTE_ICON_COLOR:"#FF0000",NOTE_HEADER:"Error occured!",NOTE_TEXT:"Error occured while try to get new data.",NOTE_COLOR:"#FF0000"}]})},dataType:"json"});else try{s(dataJSON)}catch(o){e.debug.error("need data json"),e.debug.error(o)}}function s(r){!1!==n&&(l.counterBackgroundColor=e.escapeHTML(l.counterBackgroundColor),l.counterFontColor=e.escapeHTML(l.counterFontColor),l.mainIcon=e.escapeHTML(l.mainIcon),l.mainIconBackgroundColor=e.escapeHTML(l.mainIconBackgroundColor),l.mainIconColor=e.escapeHTML(l.mainIconColor));var t=$("<div></div>");t.addClass("toggleNotifications"),t.attr("id",o+"_toggleNote"),t.attr("toggled","true");var a="#"+o+"_ul";t.on("touchstart click",function(){var e="false"==t.attr("toggled")?"true":"false";t.attr("toggled",e),$(a).fadeToggle("fast")}),$(document).on("touchstart click",function(e){!t.is(e.target)&&0===t.has(e.target).length&&!$(e.target).parents(a).length>0&&"false"==t.attr("toggled")&&(t.attr("toggled",!0),$(a).fadeToggle("fast"))});var i=$("<div></div>");i.addClass("count"),t.append(i);var s=$("<div></div>");s.addClass("num"),s.css("background",l.counterBackgroundColor),s.css("color",l.counterFontColor),s.attr("id",o+"_numdiv"),s.html(r.row.length),i.append(s);var u=$("<label></label>");u.addClass("show"),u.css("background",l.mainIconBackgroundColor);var g=$("<i></i>");g.addClass("fa"),g.addClass(l.mainIcon),g.css("color",l.mainIconColor),l.mainIconBlinking&&g.addClass("fa-blink"),u.append(g),t.append(u),d.append(t),c(r)}function c(r){var t="#"+o+"_toggleNote";if($(t).hide(),r.row){var a="#"+o+"_numdiv",i="#"+o+"_ul";r.row.length>0?($(a).css("background",l.counterBackgroundColor),$(t).show(),$(a).show(),$(a).text(r.row.length),$(i).remove(),function(r,t){var a=$("<ul></ul>");a.attr("id",o+"_ul"),a.addClass("notifications"),a.addClass("notificationstoggle");var i="#"+o+"_toggleNote";"false"==$(i).attr("toggled")&&a.toggle();t.row&&$.each(t.row,function(o,t){if(l.browserNotifications.enabled)try{var i,s;t.NOTE_HEADER&&(i=e.removeHTML(t.NOTE_HEADER)),t.NOTE_TEXT&&(s=e.removeHTML(t.NOTE_TEXT),s=e.cutString(s,l.browserNotifications.cutBodyTextAfter)),setTimeout(function(){if("Notification"in window)if("granted"===Notification.permission){var o=new Notification(i,{body:s,requireInteraction:l.browserNotifications.requireInteraction});l.browserNotifications.link&&t.NOTE_LINK&&(o.onclick=function(o){e.link(t.NOTE_LINK)})}else"denied"!==Notification.permission&&Notification.requestPermission(function(o){if("granted"===o){var r=new Notification(i,{body:s,requireInteraction:l.browserNotifications.requireInteraction});l.browserNotifications.link&&t.NOTE_LINK&&(r.onclick=function(o){e.link(t.NOTE_LINK)})}});else e.debug.Error("This browser does not support system notifications")},150*o)}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}!1!==n&&(t.NOTE_HEADER&&(t.NOTE_HEADER=e.escapeHTML(t.NOTE_HEADER)),t.NOTE_ICON&&(t.NOTE_ICON=e.escapeHTML(t.NOTE_ICON)),t.NOTE_ICON_COLOR&&(t.NOTE_ICON_COLOR=e.escapeHTML(t.NOTE_ICON_COLOR)),t.NOTE_TEXT&&(t.NOTE_TEXT=e.escapeHTML(t.NOTE_TEXT)));var c=$("<a></a>");t.NOTE_LINK&&(c.attr("href",t.NOTE_LINK),l.linkTargetBlank&&c.attr("target","_blank"),c.on("touchstart click",function(e){"false"==r.attr("toggled")&&(r.attr("toggled",!0),$(a).fadeToggle("fast"))}));var d=$("<li></li>");if(d.addClass("note"),t.NOTE_COLOR&&d.css("box-shadow","-5px 0 0 0 "+t.NOTE_COLOR),t.NOTE_ACCEPT||t.NOTE_DECLINE){if(d.css("padding-right","32px"),t.NOTE_ACCEPT){var u=$("<a></a>");u.addClass("accept-a"),u.attr("href",t.NOTE_ACCEPT);var g=$("<i></i>");g.addClass("fa"),g.addClass(l.accept.icon),g.css("color",l.accept.color),g.css("font-size","20px"),u.append(g),d.append(u)}if(t.NOTE_DECLINE){var f=$("<a></a>");f.addClass("decline-a"),f.attr("href",t.NOTE_DECLINE),t.NOTE_ACCEPT&&f.css("bottom","40px");var p=$("<i></i>");p.addClass("fa"),p.addClass(l.decline.icon),p.css("color",l.decline.color),p.css("font-size","24px"),f.append(p),d.append(f)}}var N=$("<div></div>");N.addClass("note-header");var E=$("<i></i>");E.addClass("fa"),t.NOTE_ICON&&E.addClass(t.NOTE_ICON),t.NOTE_ICON_COLOR&&E.css("color",t.NOTE_ICON_COLOR),E.addClass("fa-lg"),N.append(E),t.NOTE_HEADER&&N.append(t.NOTE_HEADER),d.append(N);var T=$("<span></span>");T.addClass("note-info"),t.NOTE_TEXT&&T.html(t.NOTE_TEXT),d.append(T),c.append(d),a.append(c)});$("body").append(a)}($(t),r)):(l.showAlways&&($(t).show(),$(a).hide()),$(i).remove())}}var l={};l=e.jsonSaveExtend({refresh:0,mainIcon:"fa-bell",mainIconColor:"white",mainIconBackgroundColor:"rgba(70,70,70,0.9)",mainIconBlinking:!1,counterBackgroundColor:"rgb(232, 55, 55 )",counterFontColor:"white",linkTargetBlank:!1,showAlways:!1,browserNotifications:{enabled:!0,cutBodyTextAfter:100,link:!1},accept:{color:"#44e55c",icon:"fa-check"},decline:{color:"#b73a21",icon:"fa-close"}},t);var d=function(e){var o=$("<li></li>");o.addClass("t-NavigationBar-item");var t=$("<div></div>");return t.attr("id",e),t.bind("apexrefresh",function(){0==d.children("span").length&&(r?i(c):c(dataJSON))}),o.append(t),$(".t-NavigationBar").prepend(o),t}(o);if(l.browserNotifications.enabled)try{"Notification"in window?Notification.requestPermission():e.debug.error("This browser does not support system notifications")}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}i(s),l.refresh>0&&setInterval(function(){0==d.children("span").length&&(r?i(c):c(dataJSON))},1e3*l.refresh)}}}();