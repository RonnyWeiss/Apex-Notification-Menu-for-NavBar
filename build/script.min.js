var notificationMenu=function(){"use strict";var e={version:"1.0.5",isAPEX:function(){return"undefined"!=typeof apex},debug:{info:function(o){e.isAPEX()&&apex.debug.info(o)},error:function(o){e.isAPEX()?apex.debug.error(o):console.error(o)}},escapeHTML:function(o){if(null===o)return null;if(void 0!==o){if("object"==typeof o)try{o=JSON.stringify(o)}catch(e){}return e.isAPEX()?apex.util.escapeHTML(String(o)):(o=String(o)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}},jsonSaveExtend:function(e,o){var r={};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){console.error("Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(o)}else r=o;try{r=$.extend(!0,e,o)}catch(o){console.error("Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(o),r=e,console.error(r)}return r},link:function(e){return window.location=e},cutString:function(e,o){try{return o<0?e:e.length>o?e.substring(0,o-3)+"...":e}catch(o){return e}},removeHTML:function(o){return e.isAPEX()&&apex.util&&apex.util.stripHTML?apex.util.stripHTML(o):$("<div/>").html(o).text()}};return{initialize:function(o,r,n,t,a){function i(o){if(l=!0,r)apex.server.plugin(r,{pageItems:t},{success:o,error:function(r){e.debug.error(r.responseText),l=!1,o({row:[{NOTE_ICON:"fa-exclamation-triangle",NOTE_ICON_COLOR:"#FF0000",NOTE_HEADER:"Error occured!",NOTE_TEXT:"Error occured while try to get new data.",NOTE_COLOR:"#FF0000"}]})},dataType:"json"});else try{s(dataJSON)}catch(o){e.debug.error("need data json"),e.debug.error(o)}}function s(r){!1!==a&&(d.counterBackgroundColor=e.escapeHTML(d.counterBackgroundColor),d.counterFontColor=e.escapeHTML(d.counterFontColor),d.mainIcon=e.escapeHTML(d.mainIcon),d.mainIconBackgroundColor=e.escapeHTML(d.mainIconBackgroundColor),d.mainIconColor=e.escapeHTML(d.mainIconColor));var n=$("<div></div>");n.addClass("toggleNotifications"),n.attr("id",o+"_toggleNote");var t="#"+o+"_ul";n.on("touchstart click",function(){$(t).toggleClass("toggleList")}),$(document).on("touchstart click",function(e){!n.is(e.target)&&0===n.has(e.target).length&&!$(e.target).parents(t).length>0&&$(t).toggleClass("toggleList")});var i=$("<div></div>");i.addClass("count"),n.append(i);var s=$("<div></div>");s.addClass("num"),s.css("background",d.counterBackgroundColor),s.css("color",d.counterFontColor),s.attr("id",o+"_numdiv"),s.html(r.row.length),i.append(s);var l=$("<label></label>");l.addClass("show"),l.css("background",d.mainIconBackgroundColor);var f=$("<i></i>");f.addClass("fa"),f.addClass(d.mainIcon),f.css("color",d.mainIconColor),d.mainIconBlinking&&f.addClass("fa-blink"),l.append(f),n.append(l),u.append(n),c(r)}function c(r){var n="#"+o+"_toggleNote";if($(n).hide(),r.row){var t="#"+o+"_numdiv",i="#"+o+"_ul";r.row.length>0?($(t).css("background",d.counterBackgroundColor),$(n).show(),$(t).show(),$(t).text(r.row.length),$(i).empty(),function(r,n){var t,i=!1;$("#"+o+"_ul").length?(t=$("#"+o+"_ul"),i=!0):((t=$("<ul></ul>")).attr("id",o+"_ul"),t.addClass("notifications"),t.addClass("toggleList"));i&&d.hideOnRefresh&&!1===$(t).hasClass("toggleList")&&$(t).addClass("toggleList");n.row&&$.each(n.row,function(o,r){if(d.browserNotifications.enabled&&l&&1!=r.NO_BROWSER_NOTIFICATION)try{var n,i;r.NOTE_HEADER&&(n=e.removeHTML(r.NOTE_HEADER)),r.NOTE_TEXT&&(i=e.removeHTML(r.NOTE_TEXT),i=e.cutString(i,d.browserNotifications.cutBodyTextAfter)),setTimeout(function(){if("Notification"in window)if("granted"===Notification.permission){var o=new Notification(n,{body:i,requireInteraction:d.browserNotifications.requireInteraction});d.browserNotifications.link&&r.NOTE_LINK&&(o.onclick=function(o){e.link(r.NOTE_LINK)})}else"denied"!==Notification.permission&&Notification.requestPermission(function(o){if("granted"===o){var t=new Notification(n,{body:i,requireInteraction:d.browserNotifications.requireInteraction});d.browserNotifications.link&&r.NOTE_LINK&&(t.onclick=function(o){e.link(r.NOTE_LINK)})}});else e.debug.Error("This browser does not support system notifications")},150*o)}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}!1!==a&&(r.NOTE_HEADER&&(r.NOTE_HEADER=e.escapeHTML(r.NOTE_HEADER)),r.NOTE_ICON&&(r.NOTE_ICON=e.escapeHTML(r.NOTE_ICON)),r.NOTE_ICON_COLOR&&(r.NOTE_ICON_COLOR=e.escapeHTML(r.NOTE_ICON_COLOR)),r.NOTE_TEXT&&(r.NOTE_TEXT=e.escapeHTML(r.NOTE_TEXT)));var s=$("<a></a>");r.NOTE_LINK&&(s.attr("href",r.NOTE_LINK),d.linkTargetBlank&&s.attr("target","_blank"),s.on("touchstart click",function(e){$(t).addClass("toggleList")}));var c=$("<li></li>");if(c.addClass("note"),r.NOTE_COLOR&&c.css("box-shadow","-5px 0 0 0 "+r.NOTE_COLOR),r.NOTE_ACCEPT||r.NOTE_DECLINE){if(c.css("padding-right","32px"),r.NOTE_ACCEPT){var u=$("<a></a>");u.addClass("accept-a"),u.attr("href",r.NOTE_ACCEPT);var f=$("<i></i>");f.addClass("fa"),f.addClass(d.accept.icon),f.css("color",d.accept.color),f.css("font-size","20px"),u.append(f),c.append(u)}if(r.NOTE_DECLINE){var g=$("<a></a>");g.addClass("decline-a"),g.attr("href",r.NOTE_DECLINE),r.NOTE_ACCEPT&&g.css("bottom","40px");var p=$("<i></i>");p.addClass("fa"),p.addClass(d.decline.icon),p.css("color",d.decline.color),p.css("font-size","24px"),g.append(p),c.append(g)}}var N=$("<div></div>");N.addClass("note-header");var E=$("<i></i>");E.addClass("fa"),r.NOTE_ICON&&E.addClass(r.NOTE_ICON),r.NOTE_ICON_COLOR&&E.css("color",r.NOTE_ICON_COLOR),E.addClass("fa-lg"),N.append(E),r.NOTE_HEADER&&N.append(r.NOTE_HEADER),c.append(N);var T=$("<span></span>");T.addClass("note-info"),r.NOTE_TEXT&&T.html(r.NOTE_TEXT),c.append(T),s.append(c),t.append(s)});$("body").append(t)}($(n),r)):(d.showAlways&&($(n).show(),$(t).hide()),$(i).empty())}}var l=!0,d={};d=e.jsonSaveExtend({refresh:0,mainIcon:"fa-bell",mainIconColor:"white",mainIconBackgroundColor:"rgba(70,70,70,0.9)",mainIconBlinking:!1,counterBackgroundColor:"rgb(232, 55, 55 )",counterFontColor:"white",linkTargetBlank:!1,showAlways:!1,browserNotifications:{enabled:!0,cutBodyTextAfter:100,link:!1},accept:{color:"#44e55c",icon:"fa-check"},decline:{color:"#b73a21",icon:"fa-close"},hideOnRefresh:!0},n);var u=function(e){var o=$("<li></li>");o.addClass("t-NavigationBar-item");var n=$("<div></div>");return n.attr("id",e),n.bind("apexrefresh",function(){0==u.children("span").length&&(r?i(c):c(dataJSON))}),o.append(n),$(".t-NavigationBar").prepend(o),n}(o);if(d.browserNotifications.enabled)try{"Notification"in window?Notification.requestPermission():e.debug.error("This browser does not support system notifications")}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}i(s),d.refresh>0&&setInterval(function(){0==u.children("span").length&&(r?i(c):c(dataJSON))},1e3*d.refresh)}}}();