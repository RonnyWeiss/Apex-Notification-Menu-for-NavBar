var notificationMenu=function(){"use strict";var e={version:"1.0.5",isAPEX:function(){return"undefined"!=typeof apex},debug:{info:function(o){e.isAPEX()&&apex.debug.info(o)},error:function(o){e.isAPEX()?apex.debug.error(o):console.error(o)}},escapeHTML:function(o){if(null===o)return null;if(void 0!==o){if("object"==typeof o)try{o=JSON.stringify(o)}catch(e){}return e.isAPEX()?apex.util.escapeHTML(String(o)):(o=String(o)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}},jsonSaveExtend:function(e,o){var r={};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){console.error("Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(o)}else r=o;try{r=$.extend(!0,e,o)}catch(o){console.error("Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(o),r=e,console.error(r)}return r},link:function(e){return window.location=e},cutString:function(e,o){try{return o<0?e:e.length>o?e.substring(0,o-3)+"...":e}catch(o){return e}}};return{initialize:function(o,r,t,n,a){function i(o){if(r)apex.server.plugin(r,{pageItems:n},{success:o,error:function(r){e.debug.error(r.responseText),o({row:[{NOTE_ICON:"fa-exclamation-triangle",NOTE_ICON_COLOR:"#FF0000",NOTE_HEADER:"Error occured!",NOTE_TEXT:"Error occured while try to get new data.",NOTE_COLOR:"#FF0000"}]})},dataType:"json"});else try{s(dataJSON)}catch(o){e.debug.error("need data json"),e.debug.error(o)}}function s(r){!1!==a&&(d.counterBackgroundColor=e.escapeHTML(d.counterBackgroundColor),d.counterFontColor=e.escapeHTML(d.counterFontColor),d.mainIcon=e.escapeHTML(d.mainIcon),d.mainIconBackgroundColor=e.escapeHTML(d.mainIconBackgroundColor),d.mainIconColor=e.escapeHTML(d.mainIconColor));var t=$("<div></div>");t.addClass("toggleNotifications"),t.attr("id",o+"_toggleNote"),t.attr("toggled","true");var n="#"+o+"_ul";t.on("touchstart click",function(){var e="false"==t.attr("toggled")?"true":"false";t.attr("toggled",e),$(n).fadeToggle("fast")}),$(document).on("touchstart click",function(e){!t.is(e.target)&&0===t.has(e.target).length&&!$(e.target).parents(n).length>0&&"false"==t.attr("toggled")&&(t.attr("toggled",!0),$(n).fadeToggle("fast"))});var i=$("<div></div>");i.addClass("count"),t.append(i);var s=$("<div></div>");s.addClass("num"),s.css("background",d.counterBackgroundColor),s.css("color",d.counterFontColor),s.attr("id",o+"_numdiv"),s.html(r.row.length),i.append(s);var u=$("<label></label>");u.addClass("show"),u.css("background",d.mainIconBackgroundColor);var g=$("<i></i>");g.addClass("fa"),g.addClass(d.mainIcon),g.css("color",d.mainIconColor),d.mainIconBlinking&&g.addClass("fa-blink"),u.append(g),t.append(u),l.append(t),c(r)}function c(r){var t="#"+o+"_toggleNote";if($(t).hide(),r.row){var n="#"+o+"_numdiv",i="#"+o+"_ul";r.row.length>0?($(n).css("background",d.counterBackgroundColor),$(t).show(),$(n).show(),$(n).text(r.row.length),$(i).remove(),function(r,t){var n=$("<ul></ul>");n.attr("id",o+"_ul"),n.addClass("notifications"),n.addClass("notificationstoggle");var i="#"+o+"_toggleNote";"false"==$(i).attr("toggled")&&n.toggle();t.row&&$.each(t.row,function(o,t){if(d.browserNotifications.enabled)try{setTimeout(function(){if("Notification"in window)if("granted"===Notification.permission){var o,r;t.NOTE_HEADER&&(o=$("<div/>").html(t.NOTE_HEADER).text()),t.NOTE_TEXT&&(r=$("<div/>").html(t.NOTE_TEXT).text(),r=e.cutString(r,d.browserNotifications.cutBodyTextAfter));var n=new Notification(o,{body:r,requireInteraction:d.browserNotifications.requireInteraction});n.onclick=function(o){e.link(t.NOTE_LINK)}}else"denied"!==Notification.permission&&Notification.requestPermission(function(e){if("granted"===e)new Notification(o,{body:r,requireInteraction:d.browserNotifications.requireInteraction})});else e.debug.Error("This browser does not support system notifications")},150*o)}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}!1!==a&&(t.NOTE_HEADER&&(t.NOTE_HEADER=e.escapeHTML(t.NOTE_HEADER)),t.NOTE_ICON&&(t.NOTE_ICON=e.escapeHTML(t.NOTE_ICON)),t.NOTE_ICON_COLOR&&(t.NOTE_ICON_COLOR=e.escapeHTML(t.NOTE_ICON_COLOR)),t.NOTE_TEXT&&(t.NOTE_TEXT=e.escapeHTML(t.NOTE_TEXT)));var i=$("<a></a>");t.NOTE_LINK&&(i.attr("href",t.NOTE_LINK),d.linkTargetBlank&&i.attr("target","_blank"),i.on("touchstart click",function(e){"false"==r.attr("toggled")&&(r.attr("toggled",!0),$(n).fadeToggle("fast"))}));var s=$("<li></li>");s.addClass("note"),t.NOTE_COLOR&&s.css("box-shadow","-5px 0 0 0 "+t.NOTE_COLOR);var c=$("<div></div>");c.addClass("note-header");var l=$("<i></i>");l.addClass("fa"),t.NOTE_ICON&&l.addClass(t.NOTE_ICON),t.NOTE_ICON_COLOR&&l.css("color",t.NOTE_ICON_COLOR),l.addClass("fa-lg"),c.append(l),t.NOTE_HEADER&&c.append(t.NOTE_HEADER),s.append(c);var u=$("<span></span>");u.addClass("note-info"),t.NOTE_TEXT&&u.html(t.NOTE_TEXT),s.append(u),i.append(s),n.append(i)});$("body").append(n)}($(t),r)):(d.showAlways&&($(t).show(),$(n).hide()),$(i).remove())}}var d={};d=e.jsonSaveExtend({refresh:0,mainIcon:"fa-bell",mainIconColor:"white",mainIconBackgroundColor:"rgba(70,70,70,0.9)",mainIconBlinking:!1,counterBackgroundColor:"rgb(232, 55, 55 )",counterFontColor:"white",linkTargetBlank:!1,showAlways:!1,browserNotifications:{enabled:!0,cutBodyTextAfter:100}},t);var l=function(e){var o=$("<li></li>");o.addClass("t-NavigationBar-item");var t=$("<div></div>");return t.attr("id",e),t.bind("apexrefresh",function(){0==l.children("span").length&&(r?i(c):c(dataJSON))}),o.append(t),$(".t-NavigationBar").prepend(o),t}(o);if(d.browserNotifications.enabled)try{"Notification"in window?Notification.requestPermission():e.debug.error("This browser does not support system notifications")}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}i(s),d.refresh>0&&setInterval(function(){0==l.children("span").length&&(r?i(c):c(dataJSON))},1e3*d.refresh)}}}();