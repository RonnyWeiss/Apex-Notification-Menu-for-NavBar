var notificationMenu=function(){"use strict";var e={version:"1.0.5",isAPEX:function(){return"undefined"!=typeof apex},debug:{info:function(o){e.isAPEX()&&apex.debug.info(o)},error:function(o){e.isAPEX()?apex.debug.error(o):console.error(o)}},escapeHTML:function(o){if(null===o)return null;if(void 0!==o){if("object"==typeof o)try{o=JSON.stringify(o)}catch(e){}return e.isAPEX()?apex.util.escapeHTML(String(o)):(o=String(o)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}},jsonSaveExtend:function(e,o){var r={};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){console.error("Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(o)}else r=o;try{r=$.extend(!0,e,o)}catch(o){console.error("Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(o),r=e,console.error(r)}return r},link:function(e){return window.location=e},cutString:function(e,o){try{return o<0?e:e.length>o?e.substring(0,o-3)+"...":e}catch(o){return e}},removeHTML:function(o){return e.isAPEX()&&apex.util&&apex.util.stripHTML?apex.util.stripHTML(o):$("<div/>").html(o).text()}};return{initialize:function(o,r,t,n,a){function i(o){if(r)apex.server.plugin(r,{pageItems:n},{success:o,error:function(r){e.debug.error(r.responseText),o({row:[{NOTE_ICON:"fa-exclamation-triangle",NOTE_ICON_COLOR:"#FF0000",NOTE_HEADER:"Error occured!",NOTE_TEXT:"Error occured while try to get new data.",NOTE_COLOR:"#FF0000"}]})},dataType:"json"});else try{s(dataJSON)}catch(o){e.debug.error("need data json"),e.debug.error(o)}}function s(r){!1!==a&&(l.counterBackgroundColor=e.escapeHTML(l.counterBackgroundColor),l.counterFontColor=e.escapeHTML(l.counterFontColor),l.mainIcon=e.escapeHTML(l.mainIcon),l.mainIconBackgroundColor=e.escapeHTML(l.mainIconBackgroundColor),l.mainIconColor=e.escapeHTML(l.mainIconColor));var t=$("<div></div>");t.addClass("toggleNotifications"),t.attr("id",o+"_toggleNote"),t.attr("toggled","true");var n="#"+o+"_ul";t.on("touchstart click",function(){var e="false"==t.attr("toggled")?"true":"false";t.attr("toggled",e),$(n).fadeToggle("fast")}),l.hideOnRefresh&&$(document).on("touchstart click",function(e){!t.is(e.target)&&0===t.has(e.target).length&&!$(e.target).parents(n).length>0&&"false"==t.attr("toggled")&&(t.attr("toggled",!0),$(n).fadeToggle("fast"))});var i=$("<div></div>");i.addClass("count"),t.append(i);var s=$("<div></div>");s.addClass("num"),s.css("background",l.counterBackgroundColor),s.css("color",l.counterFontColor),s.attr("id",o+"_numdiv"),s.html(r.row.length),i.append(s);var u=$("<label></label>");u.addClass("show"),u.css("background",l.mainIconBackgroundColor);var f=$("<i></i>");f.addClass("fa"),f.addClass(l.mainIcon),f.css("color",l.mainIconColor),l.mainIconBlinking&&f.addClass("fa-blink"),u.append(f),t.append(u),d.append(t),c(r)}function c(r){var t="#"+o+"_toggleNote";if($(t).hide(),r.row){var n="#"+o+"_numdiv",i="#"+o+"_ul";r.row.length>0?($(n).css("background",l.counterBackgroundColor),$(t).show(),$(n).show(),$(n).text(r.row.length),$(i).empty(),function(r,t){var n;$("#"+o+"_ul").length?n=$("#"+o+"_ul"):((n=$("<ul></ul>")).attr("id",o+"_ul"),n.addClass("notifications"),n.addClass("notificationstoggle"));var i="#"+o+"_toggleNote";console.log(l.hideOnRefresh),"false"==$(i).attr("toggled")&&l.hideOnRefresh&&n.toggle();t.row&&$.each(t.row,function(o,t){if(l.browserNotifications.enabled&&1!=t.NO_BROWSER_NOTIFICATION)try{var i,s;t.NOTE_HEADER&&(i=e.removeHTML(t.NOTE_HEADER)),t.NOTE_TEXT&&(s=e.removeHTML(t.NOTE_TEXT),s=e.cutString(s,l.browserNotifications.cutBodyTextAfter)),setTimeout(function(){if("Notification"in window)if("granted"===Notification.permission){var o=new Notification(i,{body:s,requireInteraction:l.browserNotifications.requireInteraction});l.browserNotifications.link&&t.NOTE_LINK&&(o.onclick=function(o){e.link(t.NOTE_LINK)})}else"denied"!==Notification.permission&&Notification.requestPermission(function(o){if("granted"===o){var r=new Notification(i,{body:s,requireInteraction:l.browserNotifications.requireInteraction});l.browserNotifications.link&&t.NOTE_LINK&&(r.onclick=function(o){e.link(t.NOTE_LINK)})}});else e.debug.Error("This browser does not support system notifications")},150*o)}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}!1!==a&&(t.NOTE_HEADER&&(t.NOTE_HEADER=e.escapeHTML(t.NOTE_HEADER)),t.NOTE_ICON&&(t.NOTE_ICON=e.escapeHTML(t.NOTE_ICON)),t.NOTE_ICON_COLOR&&(t.NOTE_ICON_COLOR=e.escapeHTML(t.NOTE_ICON_COLOR)),t.NOTE_TEXT&&(t.NOTE_TEXT=e.escapeHTML(t.NOTE_TEXT)));var c=$("<a></a>");t.NOTE_LINK&&(c.attr("href",t.NOTE_LINK),l.linkTargetBlank&&c.attr("target","_blank"),c.on("touchstart click",function(e){"false"==r.attr("toggled")&&(r.attr("toggled",!0),$(n).fadeToggle("fast"))}));var d=$("<li></li>");if(d.addClass("note"),t.NOTE_COLOR&&d.css("box-shadow","-5px 0 0 0 "+t.NOTE_COLOR),t.NOTE_ACCEPT||t.NOTE_DECLINE){if(d.css("padding-right","32px"),t.NOTE_ACCEPT){var u=$("<a></a>");u.addClass("accept-a"),u.attr("href",t.NOTE_ACCEPT);var f=$("<i></i>");f.addClass("fa"),f.addClass(l.accept.icon),f.css("color",l.accept.color),f.css("font-size","20px"),u.append(f),d.append(u)}if(t.NOTE_DECLINE){var g=$("<a></a>");g.addClass("decline-a"),g.attr("href",t.NOTE_DECLINE),t.NOTE_ACCEPT&&g.css("bottom","40px");var p=$("<i></i>");p.addClass("fa"),p.addClass(l.decline.icon),p.css("color",l.decline.color),p.css("font-size","24px"),g.append(p),d.append(g)}}var N=$("<div></div>");N.addClass("note-header");var T=$("<i></i>");T.addClass("fa"),t.NOTE_ICON&&T.addClass(t.NOTE_ICON),t.NOTE_ICON_COLOR&&T.css("color",t.NOTE_ICON_COLOR),T.addClass("fa-lg"),N.append(T),t.NOTE_HEADER&&N.append(t.NOTE_HEADER),d.append(N);var E=$("<span></span>");E.addClass("note-info"),t.NOTE_TEXT&&E.html(t.NOTE_TEXT),d.append(E),c.append(d),n.append(c)});$("body").append(n)}($(t),r)):(l.showAlways&&($(t).show(),$(n).hide()),$(i).empty())}}var l={};l=e.jsonSaveExtend({refresh:0,mainIcon:"fa-bell",mainIconColor:"white",mainIconBackgroundColor:"rgba(70,70,70,0.9)",mainIconBlinking:!1,counterBackgroundColor:"rgb(232, 55, 55 )",counterFontColor:"white",linkTargetBlank:!1,showAlways:!1,browserNotifications:{enabled:!0,cutBodyTextAfter:100,link:!1},accept:{color:"#44e55c",icon:"fa-check"},decline:{color:"#b73a21",icon:"fa-close"},hideOnRefresh:!0},t);var d=function(e){var o=$("<li></li>");o.addClass("t-NavigationBar-item");var t=$("<div></div>");return t.attr("id",e),t.bind("apexrefresh",function(){0==d.children("span").length&&(r?i(c):c(dataJSON))}),o.append(t),$(".t-NavigationBar").prepend(o),t}(o);if(l.browserNotifications.enabled)try{"Notification"in window?Notification.requestPermission():e.debug.error("This browser does not support system notifications")}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}i(s),l.refresh>0&&setInterval(function(){0==d.children("span").length&&(r?i(c):c(dataJSON))},1e3*l.refresh)}}}();