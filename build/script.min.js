var notificationMenu=function(){"use strict";var o={version:"1.0.5",isAPEX:function(){return"undefined"!=typeof apex},debug:{info:function(r){o.isAPEX()&&apex.debug.info(r)},error:function(r){o.isAPEX()?apex.debug.error(r):console.error(r)}},escapeHTML:function(r){if(null===r)return null;if(void 0!==r){if("object"==typeof r)try{r=JSON.stringify(r)}catch(o){}return o.isAPEX()?apex.util.escapeHTML(String(r)):(r=String(r)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}},jsonSaveExtend:function(o,r){var e={};if("string"==typeof r)try{r=JSON.parse(r)}catch(o){console.error("Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used."),console.error(o),console.error(r)}else e=r;try{e=$.extend(!0,o,r)}catch(r){console.error("Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(r),e=o,console.error(e)}return e}};return{initialize:function(r,e,t,a,n){function i(r){if(e)apex.server.plugin(e,{pageItems:a},{success:r,error:function(e){o.debug.error(e.responseText),r({row:[{NOTE_ICON:"fa-exclamation-triangle",NOTE_ICON_COLOR:"#FF0000",NOTE_HEADER:"Error occured!",NOTE_TEXT:"Error occured while try to get new data.",NOTE_COLOR:"#FF0000"}]})},dataType:"json"});else try{s(dataJSON)}catch(r){o.debug.error("need data json"),o.debug.error(r)}}function s(e){!1!==n&&(l.counterBackgroundColor=o.escapeHTML(l.counterBackgroundColor),l.counterFontColor=o.escapeHTML(l.counterFontColor),l.mainIcon=o.escapeHTML(l.mainIcon),l.mainIconBackgroundColor=o.escapeHTML(l.mainIconBackgroundColor),l.mainIconColor=o.escapeHTML(l.mainIconColor));var t=$("<div></div>");t.addClass("toggleNotifications"),t.attr("id",r+"_toggleNote"),t.attr("toggled","true");var a="#"+r+"_ul";t.on("touchstart click",function(){var o="false"==t.attr("toggled")?"true":"false";t.attr("toggled",o),$(a).fadeToggle("fast")}),$(document).on("touchstart click",function(o){!t.is(o.target)&&0===t.has(o.target).length&&!$(o.target).parents(a).length>0&&"false"==t.attr("toggled")&&(t.attr("toggled",!0),$(a).fadeToggle("fast"))});var i=$("<div></div>");i.addClass("count"),t.append(i);var s=$("<div></div>");s.addClass("num"),s.css("background",l.counterBackgroundColor),s.css("color",l.counterFontColor),s.attr("id",r+"_numdiv"),s.html(e.row.length),i.append(s);var g=$("<label></label>");g.addClass("show"),g.css("background",l.mainIconBackgroundColor);var u=$("<i></i>");u.addClass("fa"),u.addClass(l.mainIcon),u.css("color",l.mainIconColor),l.mainIconBlinking&&u.addClass("fa-blink"),g.append(u),t.append(g),d.append(t),c(e)}function c(e){var t="#"+r+"_toggleNote";if($(t).hide(),e.row){var a="#"+r+"_numdiv",i="#"+r+"_ul";e.row.length>0?($(a).css("background",l.counterBackgroundColor),$(t).show(),$(a).show(),$(a).text(e.row.length),$(i).remove(),function(e,t){var a="",i=$("<ul></ul>");i.attr("id",r+"_ul"),i.addClass("notifications"),i.addClass("notificationstoggle");var s="#"+r+"_toggleNote";"false"==$(s).attr("toggled")&&i.toggle();if(t.row)for(var c=0;c<t.row.length;c++){!1!==n&&(t.row[c].NOTE_HEADER&&(t.row[c].NOTE_HEADER=o.escapeHTML(t.row[c].NOTE_HEADER)),t.row[c].NOTE_ICON&&(t.row[c].NOTE_ICON=o.escapeHTML(t.row[c].NOTE_ICON)),t.row[c].NOTE_ICON_COLOR&&(t.row[c].NOTE_ICON_COLOR=o.escapeHTML(t.row[c].NOTE_ICON_COLOR)),t.row[c].NOTE_TEXT&&(t.row[c].NOTE_TEXT=o.escapeHTML(t.row[c].NOTE_TEXT)));var d=$("<a></a>");t.row[c].NOTE_LINK&&(d.attr("href",t.row[c].NOTE_LINK),l.linkTargetBlank&&d.attr("target","_blank"),d.on("touchstart click",function(o){"false"==e.attr("toggled")&&(e.attr("toggled",!0),$(i).fadeToggle("fast"))}));var g=$("<li></li>");g.addClass("note"),t.row[c].NOTE_COLOR&&g.css("box-shadow","-5px 0 0 0 "+t.row[c].NOTE_COLOR);var u=$("<div></div>");u.addClass("note-header");var f=$("<i></i>");f.addClass("fa"),t.row[c].NOTE_ICON&&f.addClass(t.row[c].NOTE_ICON),t.row[c].NOTE_ICON_COLOR&&f.css("color",t.row[c].NOTE_ICON_COLOR),f.addClass("fa-lg"),u.append(f),t.row[c].NOTE_HEADER&&u.append(t.row[c].NOTE_HEADER),g.append(u);var O=$("<span></span>");O.addClass("note-info"),t.row[c].NOTE_TEXT&&O.html(t.row[c].NOTE_TEXT),g.append(O),d.append(g),i.append(d),l.useBrowserNotificationAPI&&t.row[c].BROWSER_NOTIFICATION&&t.row[c].BROWSER_NOTIFICATION.length>0&&(a+="â€¢ "+t.row[c].BROWSER_NOTIFICATION+"\n")}if($("body").append(i),l.useBrowserNotificationAPI&&a.length>0)try{if("Notification"in window)if("granted"===Notification.permission)new Notification("ðŸ””",{body:a});else"denied"!==Notification.permission&&Notification.requestPermission(function(o){if("granted"===o)new Notification("ðŸ””",{body:a})});else o.debug.Error("This browser does not support system notifications")}catch(r){o.debug.error("Error while try to get notification permission"),o.debug.error(r)}}($(t),e)):(l.showAlways&&($(t).show(),$(a).hide()),$(i).remove())}}var l={};l=o.jsonSaveExtend({refresh:0,mainIcon:"fa-bell",mainIconColor:"white",mainIconBackgroundColor:"rgba(70,70,70,0.9)",mainIconBlinking:!1,counterBackgroundColor:"rgb(232, 55, 55 )",counterFontColor:"white",linkTargetBlank:!0,showAlways:!1,useBrowserNotificationAPI:!0},t);var d=function(o){var r=$("<li></li>");r.addClass("t-NavigationBar-item");var t=$("<div></div>");return t.attr("id",o),t.bind("apexrefresh",function(){0==d.children("span").length&&(e?i(c):c(dataJSON))}),r.append(t),$(".t-NavigationBar").prepend(r),t}(r);if(l.useBrowserNotificationAPI)try{"Notification"in window?Notification.requestPermission():o.debug.error("This browser does not support system notifications")}catch(r){o.debug.error("Error while try to get notification permission"),o.debug.error(r)}i(s),l.refresh>0&&setInterval(function(){0==d.children("span").length&&(e?i(c):c(dataJSON))},1e3*l.refresh)}}}();