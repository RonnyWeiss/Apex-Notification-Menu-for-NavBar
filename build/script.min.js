var notificationMenu=function(){"use strict";var e={version:"1.0.5",isAPEX:function(){return"undefined"!=typeof apex},debug:{info:function(o){e.isAPEX()&&apex.debug.info(o)},error:function(o){e.isAPEX()?apex.debug.error(o):console.error(o)}},escapeHTML:function(o){if(null===o)return null;if(void 0!==o){if("object"==typeof o)try{o=JSON.stringify(o)}catch(e){}return e.isAPEX()?apex.util.escapeHTML(String(o)):(o=String(o)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}},jsonSaveExtend:function(e,o){var r={};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){console.error("Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(o)}else r=o;try{r=$.extend(!0,e,o)}catch(o){console.error("Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(o),r=e,console.error(r)}return r},link:function(e){return window.location=e},cutString:function(e,o){try{return o<0?e:e.length>o?e.substring(0,o-3)+"...":e}catch(o){return e}},removeHTML:function(o){return e.isAPEX()&&apex.util&&apex.util.stripHTML?apex.util.stripHTML(o):$("<div/>").html(o).text()}};return{initialize:function(o,r,t,n,a){function i(o){if(l=!0,r)apex.server.plugin(r,{pageItems:n},{success:o,error:function(r){e.debug.error(r.responseText),l=!1,o({row:[{NOTE_ICON:"fa-exclamation-triangle",NOTE_ICON_COLOR:"#FF0000",NOTE_HEADER:"Error occured!",NOTE_TEXT:"Error occured while try to get new data.",NOTE_COLOR:"#FF0000"}]})},dataType:"json"});else try{s(dataJSON)}catch(o){e.debug.error("need data json"),e.debug.error(o)}}function s(r){!1!==a&&(d.counterBackgroundColor=e.escapeHTML(d.counterBackgroundColor),d.counterFontColor=e.escapeHTML(d.counterFontColor),d.mainIcon=e.escapeHTML(d.mainIcon),d.mainIconBackgroundColor=e.escapeHTML(d.mainIconBackgroundColor),d.mainIconColor=e.escapeHTML(d.mainIconColor));var t=$("<div></div>");t.addClass("toggleNotifications"),t.attr("id",o+"_toggleNote"),t.attr("toggled","true");var n="#"+o+"_ul";t.on("touchstart click",function(){var e="false"==t.attr("toggled")?"true":"false";t.attr("toggled",e),$(n).fadeToggle("fast")}),d.hideOnRefresh&&$(document).on("touchstart click",function(e){!t.is(e.target)&&0===t.has(e.target).length&&!$(e.target).parents(n).length>0&&"false"==t.attr("toggled")&&(t.attr("toggled",!0),$(n).fadeToggle("fast"))});var i=$("<div></div>");i.addClass("count"),t.append(i);var s=$("<div></div>");s.addClass("num"),s.css("background",d.counterBackgroundColor),s.css("color",d.counterFontColor),s.attr("id",o+"_numdiv"),s.html(r.row.length),i.append(s);var l=$("<label></label>");l.addClass("show"),l.css("background",d.mainIconBackgroundColor);var f=$("<i></i>");f.addClass("fa"),f.addClass(d.mainIcon),f.css("color",d.mainIconColor),d.mainIconBlinking&&f.addClass("fa-blink"),l.append(f),t.append(l),u.append(t),c(r)}function c(r){var t="#"+o+"_toggleNote";if($(t).hide(),r.row){var n="#"+o+"_numdiv",i="#"+o+"_ul";r.row.length>0?($(n).css("background",d.counterBackgroundColor),$(t).show(),$(n).show(),$(n).text(r.row.length),$(i).empty(),function(r,t){var n;$("#"+o+"_ul").length?n=$("#"+o+"_ul"):((n=$("<ul></ul>")).attr("id",o+"_ul"),n.addClass("notifications"),n.addClass("notificationstoggle"));var i="#"+o+"_toggleNote";console.log(d.hideOnRefresh),"false"==$(i).attr("toggled")&&d.hideOnRefresh&&n.toggle();t.row&&$.each(t.row,function(o,t){if(d.browserNotifications.enabled&&l&&1!=t.NO_BROWSER_NOTIFICATION)try{var i,s;t.NOTE_HEADER&&(i=e.removeHTML(t.NOTE_HEADER)),t.NOTE_TEXT&&(s=e.removeHTML(t.NOTE_TEXT),s=e.cutString(s,d.browserNotifications.cutBodyTextAfter)),setTimeout(function(){if("Notification"in window)if("granted"===Notification.permission){var o=new Notification(i,{body:s,requireInteraction:d.browserNotifications.requireInteraction});d.browserNotifications.link&&t.NOTE_LINK&&(o.onclick=function(o){e.link(t.NOTE_LINK)})}else"denied"!==Notification.permission&&Notification.requestPermission(function(o){if("granted"===o){var r=new Notification(i,{body:s,requireInteraction:d.browserNotifications.requireInteraction});d.browserNotifications.link&&t.NOTE_LINK&&(r.onclick=function(o){e.link(t.NOTE_LINK)})}});else e.debug.Error("This browser does not support system notifications")},150*o)}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}!1!==a&&(t.NOTE_HEADER&&(t.NOTE_HEADER=e.escapeHTML(t.NOTE_HEADER)),t.NOTE_ICON&&(t.NOTE_ICON=e.escapeHTML(t.NOTE_ICON)),t.NOTE_ICON_COLOR&&(t.NOTE_ICON_COLOR=e.escapeHTML(t.NOTE_ICON_COLOR)),t.NOTE_TEXT&&(t.NOTE_TEXT=e.escapeHTML(t.NOTE_TEXT)));var c=$("<a></a>");t.NOTE_LINK&&(c.attr("href",t.NOTE_LINK),d.linkTargetBlank&&c.attr("target","_blank"),c.on("touchstart click",function(e){"false"==r.attr("toggled")&&(r.attr("toggled",!0),$(n).fadeToggle("fast"))}));var u=$("<li></li>");if(u.addClass("note"),t.NOTE_COLOR&&u.css("box-shadow","-5px 0 0 0 "+t.NOTE_COLOR),t.NOTE_ACCEPT||t.NOTE_DECLINE){if(u.css("padding-right","32px"),t.NOTE_ACCEPT){var f=$("<a></a>");f.addClass("accept-a"),f.attr("href",t.NOTE_ACCEPT);var g=$("<i></i>");g.addClass("fa"),g.addClass(d.accept.icon),g.css("color",d.accept.color),g.css("font-size","20px"),f.append(g),u.append(f)}if(t.NOTE_DECLINE){var p=$("<a></a>");p.addClass("decline-a"),p.attr("href",t.NOTE_DECLINE),t.NOTE_ACCEPT&&p.css("bottom","40px");var N=$("<i></i>");N.addClass("fa"),N.addClass(d.decline.icon),N.css("color",d.decline.color),N.css("font-size","24px"),p.append(N),u.append(p)}}var T=$("<div></div>");T.addClass("note-header");var E=$("<i></i>");E.addClass("fa"),t.NOTE_ICON&&E.addClass(t.NOTE_ICON),t.NOTE_ICON_COLOR&&E.css("color",t.NOTE_ICON_COLOR),E.addClass("fa-lg"),T.append(E),t.NOTE_HEADER&&T.append(t.NOTE_HEADER),u.append(T);var O=$("<span></span>");O.addClass("note-info"),t.NOTE_TEXT&&O.html(t.NOTE_TEXT),u.append(O),c.append(u),n.append(c)});$("body").append(n)}($(t),r)):(d.showAlways&&($(t).show(),$(n).hide()),$(i).empty())}}var l=!0,d={};d=e.jsonSaveExtend({refresh:0,mainIcon:"fa-bell",mainIconColor:"white",mainIconBackgroundColor:"rgba(70,70,70,0.9)",mainIconBlinking:!1,counterBackgroundColor:"rgb(232, 55, 55 )",counterFontColor:"white",linkTargetBlank:!1,showAlways:!1,browserNotifications:{enabled:!0,cutBodyTextAfter:100,link:!1},accept:{color:"#44e55c",icon:"fa-check"},decline:{color:"#b73a21",icon:"fa-close"},hideOnRefresh:!0},t);var u=function(e){var o=$("<li></li>");o.addClass("t-NavigationBar-item");var t=$("<div></div>");return t.attr("id",e),t.bind("apexrefresh",function(){0==u.children("span").length&&(r?i(c):c(dataJSON))}),o.append(t),$(".t-NavigationBar").prepend(o),t}(o);if(d.browserNotifications.enabled)try{"Notification"in window?Notification.requestPermission():e.debug.error("This browser does not support system notifications")}catch(o){e.debug.error("Error while try to get notification permission"),e.debug.error(o)}i(s),d.refresh>0&&setInterval(function(){0==u.children("span").length&&(r?i(c):c(dataJSON))},1e3*d.refresh)}}}();